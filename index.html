<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Intelligence OS v14.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { background: #020617; color: white; font-family: 'Inter', sans-serif; margin: 0; }
        .os-container { height: 100vh; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .glass { background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .app-card { transition: all 0.2s ease; cursor: pointer; border-radius: 1.5rem; height: 140px; }
        .app-card:active { transform: scale(0.95); }
        canvas { touch-action: none; background: #000; border-radius: 1rem; border: 1px solid #333; width: 100%; height: 350px; }
        .mole-hole { background: #0f172a; border-radius: 50%; width: 70px; height: 70px; border: 2px solid #1e293b; display: flex; align-items: center; justify-content: center; font-size: 2rem; cursor: pointer; }
        .mole-active { background: #6366f1; box-shadow: 0 0 20px #6366f1; transform: scale(1.1); }
    </style>
</head>
<body class="bg-[#020617]">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, memo } = React;

        // --- 1. THE ACTUAL AI CHAT ENGINE ---
        const AIChat = ({ appId, appName, apiKey }) => {
            const [msgs, setMsgs] = useState([{ role: 'assistant', content: `Hello, I am your ${appName}. How can I help you today?` }]);
            const [input, setInput] = useState("");
            const [loading, setLoading] = useState(false);

            const send = async () => {
                if (!apiKey) return alert("Please enter Groq API Key in OS Settings!");
                if (!input.trim()) return;
                const newMsgs = [...msgs, { role: 'user', content: input }];
                setMsgs(newMsgs); setInput(""); setLoading(true);
                try {
                    const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                        method: "POST",
                        headers: { "Authorization": `Bearer ${apiKey}`, "Content-Type": "application/json" },
                        body: JSON.stringify({ model: "llama-3.3-70b-versatile", messages: newMsgs })
                    });
                    const data = await res.json();
                    setMsgs([...newMsgs, data.choices[0].message]);
                } catch (e) { alert("AI Error: Connection Failed"); }
                setLoading(false);
            };

            return (
                <div className="w-full max-w-xl h-[500px] flex flex-col glass rounded-3xl overflow-hidden">
                    <div className="flex-1 p-4 overflow-y-auto space-y-4">
                        {msgs.map((m, i) => (
                            <div key={i} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                <div className={`p-3 rounded-2xl max-w-[80%] ${m.role === 'user' ? 'bg-indigo-600' : 'bg-white/10'}`}>{m.content}</div>
                            </div>
                        ))}
                        {loading && <div className="text-indigo-400 animate-pulse text-xs font-bold">NEURAL LINK PROCESSING...</div>}
                    </div>
                    <div className="p-4 bg-black/20 flex gap-2">
                        <input value={input} onChange={e=>setInput(e.target.value)} onKeyDown={e=>e.key==='Enter'&&send()} className="flex-1 bg-white/5 p-3 rounded-xl outline-none" placeholder="Ask anything..." />
                        <button onClick={send} className="bg-indigo-600 px-6 rounded-xl font-bold uppercase text-xs">Send</button>
                    </div>
                </div>
            );
        };

        // --- 2. THE ACTUAL WHACK-A-MOLE GAME ---
        const WhackGame = () => {
            const [mole, setMole] = useState(null);
            const [score, setScore] = useState(0);
            const [time, setTime] = useState(0);

            useEffect(() => {
                if (time <= 0) return;
                const mTimer = setInterval(() => setMole(Math.floor(Math.random()*9)), 800);
                const gTimer = setInterval(() => setTime(t => t - 1), 1000);
                return () => { clearInterval(mTimer); clearInterval(gTimer); };
            }, [time]);

            return (
                <div className="flex flex-col items-center">
                    <div className="flex justify-between w-64 mb-6 font-black text-indigo-400">
                        <span>SCORE: {score}</span>
                        <span>TIME: {time}s</span>
                    </div>
                    <div className="grid grid-cols-3 gap-4">
                        {[...Array(9)].map((_, i) => (
                            <div key={i} onClick={()=>{if(i===mole&&time>0){setScore(s=>s+1); setMole(null)}}}
                                 className={`mole-hole ${mole === i ? 'mole-active' : ''}`}>{mole === i ? 'üêπ' : ''}</div>
                        ))}
                    </div>
                    {time === 0 && <button onClick={()=>{setTime(30); setScore(0)}} className="mt-8 bg-indigo-600 px-10 py-3 rounded-full font-bold uppercase">Start 30s Game</button>}
                </div>
            );
        };

        // --- 3. THE ACTUAL SKETCH PAD ---
        const SketchPad = () => {
            const canvasRef = useRef(null);
            const [drawing, setDrawing] = useState(false);
            useEffect(() => {
                const c = canvasRef.current;
                c.width = c.parentElement.offsetWidth; c.height = 350;
                const ctx = c.getContext('2d'); ctx.lineCap = 'round'; ctx.strokeStyle = '#6366f1'; ctx.lineWidth = 5;
            }, []);
            const draw = (e) => {
                if(!drawing) return;
                const rect = canvasRef.current.getBoundingClientRect();
                const x = (e.clientX || e.touches[0].clientX) - rect.left;
                const y = (e.clientY || e.touches[0].clientY) - rect.top;
                const ctx = canvasRef.current.getContext('2d');
                ctx.lineTo(x, y); ctx.stroke(); ctx.beginPath(); ctx.moveTo(x, y);
            };
            return (
                <div className="w-full max-w-lg">
                    <div className="flex justify-between mb-2"><span className="text-[10px] font-bold opacity-50">SKETCH PAD PRO</span><button onClick={()=>canvasRef.current.getContext('2d').clearRect(0,0,1000,1000)} className="text-red-500 text-[10px] font-bold">CLEAR</button></div>
                    <canvas ref={canvasRef} onMouseDown={()=>setDrawing(true)} onMouseMove={draw} onMouseUp={()=>{setDrawing(false); canvasRef.current.getContext('2d').beginPath()}} onTouchStart={()=>setDrawing(true)} onTouchMove={draw} onTouchEnd={()=>{setDrawing(false); canvasRef.current.getContext('2d').beginPath()}} />
                </div>
            );
        };

        // --- 4. MAIN APP ENGINE ---
        const App = () => {
            const [activeApp, setActiveApp] = useState(null);
            const [apiKey, setApiKey] = useState(localStorage.getItem('groq_key') || '');
            const [assetIdx, setAssetIdx] = useState(0);

            // Independent Live Market
            const [prices, setPrices] = useState({ 0: Array(20).fill(65000), 1: Array(20).fill(2300), 2: Array(20).fill(83.5), 3: Array(20).fill(1.0) });
            const assets = [{n:"Bitcoin", s:"‚Çø", b:65000, c:"#F7931A"}, {n:"Gold", s:"AU", b:2300, c:"#FFD700"}, {n:"Indian Rupee", s:"‚Çπ", b:83.5, c:"#16a34a"}, {n:"US Dollar", s:"$", b:1.0, c:"#3b82f6"}];

            useEffect(() => {
                const ticker = setInterval(() => {
                    setPrices(prev => {
                        const n = {...prev};
                        [0,1,2,3].forEach(i => {
                            const last = n[i][19];
                            const drift = (Math.random()-0.49) * (assets[i].b * 0.02);
                            n[i] = [...n[i].slice(1), last + drift];
                        });
                        return n;
                    });
                }, 2000);
                return () => clearInterval(ticker);
            }, []);

            const cur = prices[assetIdx];
            const trend = cur[19] >= cur[18] ? 'up' : 'down';

            const apps = [
                { id: 'ai', name: 'Neural Intelligence', i: 'üß†', type: 'ai' },
                { id: 'med', name: 'Medical Diagnostic', i: 'ü©∫', type: 'ai' },
                { id: 'chef', name: 'Culinary Master', i: 'üë®‚Äçüç≥', type: 'ai' },
                { id: 'gym', name: 'Fitness Coach', i: 'üèãÔ∏è', type: 'ai' },
                { id: 'mole', name: 'Whack-A-Mole', i: 'üî®' },
                { id: 'sketch', name: 'Sketch Pad', i: 'üé®' },
                { id: 'settings', name: 'OS Settings', i: '‚öôÔ∏è' }
            ];

            return (
                <div className="os-container">
                    {activeApp ? (
                        <div className="fixed inset-0 z-50 glass flex flex-col p-6 overflow-y-auto">
                            <div className="flex justify-between items-center mb-8">
                                <button onClick={() => setActiveApp(null)} className="bg-white/10 px-6 py-2 rounded-full font-bold text-xs uppercase tracking-widest">‚Üê Back</button>
                                <h2 className="text-xl font-black uppercase text-indigo-400 italic tracking-tighter">{activeApp.name}</h2>
                                <div className="w-10"></div>
                            </div>
                            <div className="flex-1 flex flex-col items-center">
                                {activeApp.type === 'ai' && <AIChat appId={activeApp.id} appName={activeApp.name} apiKey={apiKey} />}
                                {activeApp.id === 'mole' && <WhackGame />}
                                {activeApp.id === 'sketch' && <SketchPad />}
                                {activeApp.id === 'settings' && (
                                    <div className="w-full max-w-md glass p-8 rounded-3xl">
                                        <h3 className="mb-4 font-black text-xs opacity-50 uppercase tracking-widest">Groq API Link</h3>
                                        <input type="password" value={apiKey} onChange={e=>{setApiKey(e.target.value); localStorage.setItem('groq_key', e.target.value)}} className="w-full bg-black/50 p-4 rounded-xl border border-white/10 outline-none focus:border-indigo-500" placeholder="Paste gsk_... here" />
                                        <p className="text-[10px] text-indigo-400 mt-4 font-bold uppercase italic">API Key required for all Neural Modules</p>
                                    </div>
                                )}
                            </div>
                        </div>
                    ) : (
                        <div className="max-w-4xl mx-auto p-6 pb-20">
                            <header className="text-center mb-10">
                                <h1 className="text-5xl font-black italic uppercase tracking-tighter">Intelligence OS</h1>
                                <p className="text-[10px] text-indigo-500 font-bold tracking-[0.5em] mt-2 uppercase underline decoration-2 underline-offset-4">Stable Core v14.0</p>
                            </header>

                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <div onClick={() => setAssetIdx((assetIdx + 1) % 4)} className="col-span-2 glass p-6 app-card flex flex-col justify-between h-auto">
                                    <div className="flex justify-between items-start">
                                        <div className="flex items-center gap-3">
                                            <div className="w-10 h-10 rounded-xl flex items-center justify-center text-xl font-bold bg-white/5" style={{color: assets[assetIdx].c}}>{assets[assetIdx].s}</div>
                                            <h3 className="font-black uppercase tracking-tight">{assets[assetIdx].n}</h3>
                                        </div>
                                        <div className={`text-right font-mono font-bold text-xl ${trend === 'up' ? 'text-green-400' : 'text-red-400'}`}>
                                            {trend === 'up' ? '‚ñ≤' : '‚ñº'} {cur[19].toFixed(2)}
                                        </div>
                                    </div>
                                    <div className="h-16 w-full mt-4">
                                        <svg className="w-full h-full" preserveAspectRatio="none" viewBox="0 0 100 20">
                                            <polyline fill="none" stroke={trend === 'up' ? '#22c55e' : '#ef4444'} strokeWidth="4" points={cur.map((p, i) => `${(i / 19) * 100},${20 - ((p / (assets[assetIdx].b * 1.5)) * 20)}`).join(' ')} />
                                        </svg>
                                    </div>
                                </div>

                                {apps.map(app => (
                                    <div key={app.id} onClick={() => setActiveApp(app)} className="glass p-6 flex flex-col items-center justify-center app-card">
                                        <span className="text-4xl mb-3">{app.i}</span>
                                        <span className="text-[9px] font-black uppercase tracking-widest text-center text-gray-400">{app.name}</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
