<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Intelligence OS v15.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { background: #010409; color: white; font-family: 'Inter', sans-serif; overflow: hidden; }
        .glass { background: rgba(13, 17, 23, 0.8); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .app-card { transition: 0.2s; cursor: pointer; border-radius: 1.5rem; height: 120px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .app-card:active { transform: scale(0.95); }
        .mole-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .hole { width: 80px; height: 80px; background: #161b22; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; border: 2px solid #30363d; cursor: pointer; }
        .mole-up { background: #5865f2; box-shadow: 0 0 20px #5865f2; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- PROTECTED CANVAS (SKETCH PAD) ---
        const SketchPad = () => {
            const canvasRef = useRef(null);
            const [isDrawing, setIsDrawing] = useState(false);
            useEffect(() => {
                const canvas = canvasRef.current;
                canvas.width = canvas.offsetWidth;
                canvas.height = 400;
                const ctx = canvas.getContext('2d');
                ctx.lineCap = 'round';
                ctx.strokeStyle = '#5865f2';
                ctx.lineWidth = 4;
            }, []);
            const draw = (e) => {
                if (!isDrawing) return;
                const rect = canvasRef.current.getBoundingClientRect();
                const x = (e.clientX || e.touches[0].clientX) - rect.left;
                const y = (e.clientY || e.touches[0].clientY) - rect.top;
                const ctx = canvasRef.current.getContext('2d');
                ctx.lineTo(x, y); ctx.stroke(); ctx.beginPath(); ctx.moveTo(x, y);
            };
            return (
                <div className="w-full h-full flex flex-col p-4">
                    <button onClick={() => canvasRef.current.getContext('2d').clearRect(0,0,1000,1000)} className="mb-4 bg-red-500/20 text-red-500 px-4 py-1 rounded-full text-xs font-bold self-end">CLEAR CANVAS</button>
                    <canvas ref={canvasRef} onMouseDown={() => setIsDrawing(true)} onMouseMove={draw} onMouseUp={() => {setIsDrawing(false); canvasRef.current.getContext('2d').beginPath()}}
                            onTouchStart={() => setIsDrawing(true)} onTouchMove={draw} onTouchEnd={() => {setIsDrawing(false); canvasRef.current.getContext('2d').beginPath()}}
                            className="w-full flex-1 bg-black rounded-3xl border border-white/10 touch-none" />
                </div>
            );
        };

        // --- NEURAL ENGINE (AI CHAT) ---
        const AIChat = ({ apiKey }) => {
            const [history, setHistory] = useState([{ role: 'assistant', content: 'Neural Link Established. How can I assist?' }]);
            const [input, setInput] = useState('');
            const [loading, setLoading] = useState(false);

            const ask = async () => {
                if (!apiKey) return alert("Missing API Key in Settings!");
                if (!input.trim()) return;
                const newHistory = [...history, { role: 'user', content: input }];
                setHistory(newHistory); setInput(''); setLoading(true);
                try {
                    const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                        method: "POST",
                        headers: { "Authorization": `Bearer ${apiKey}`, "Content-Type": "application/json" },
                        body: JSON.stringify({ model: "llama-3.3-70b-versatile", messages: newHistory })
                    });
                    const data = await res.json();
                    setHistory([...newHistory, data.choices[0].message]);
                } catch (e) { alert("Neural Link Error"); }
                setLoading(false);
            };
            return (
                <div className="w-full max-w-lg h-[500px] flex flex-col glass rounded-3xl overflow-hidden">
                    <div className="flex-1 p-4 overflow-y-auto space-y-4">
                        {history.map((m, i) => <div key={i} className={`flex ${m.role==='user'?'justify-end':'justify-start'}`}><div className={`p-3 rounded-2xl max-w-[80%] ${m.role==='user'?'bg-blue-600':'bg-white/10'}`}>{m.content}</div></div>)}
                        {loading && <div className="text-blue-400 animate-pulse text-xs uppercase font-bold">Thinking...</div>}
                    </div>
                    <div className="p-4 bg-black/40 flex gap-2">
                        <input value={input} onChange={e=>setInput(e.target.value)} onKeyDown={e=>e.key==='Enter'&&ask()} className="flex-1 bg-transparent outline-none border-b border-white/20 px-2" placeholder="Send message..." />
                        <button onClick={ask} className="bg-blue-600 px-4 py-2 rounded-xl font-bold text-xs">SEND</button>
                    </div>
                </div>
            );
        };

        // --- GAME ENGINE (WHACK-A-MOLE) ---
        const WhackAMole = () => {
            const [active, setActive] = useState(null);
            const [score, setScore] = useState(0);
            const [timeLeft, setTimeLeft] = useState(0);
            useEffect(() => {
                if (timeLeft <= 0) return;
                const t = setInterval(() => setTimeLeft(s => s - 1), 1000);
                const m = setInterval(() => setActive(Math.floor(Math.random()*9)), 700);
                return () => { clearInterval(t); clearInterval(m); };
            }, [timeLeft]);
            return (
                <div className="flex flex-col items-center gap-6">
                    <div className="flex gap-10 font-black text-blue-400 italic"><span>SCORE: {score}</span><span>TIME: {timeLeft}s</span></div>
                    <div className="mole-grid">
                        {[...Array(9)].map((_, i) => (
                            <div key={i} onClick={() => {if(i===active && timeLeft > 0){setScore(s=>s+1); setActive(null)}}} className={`hole ${active === i ? 'mole-up' : ''}`}>{active === i ? 'üêπ' : ''}</div>
                        ))}
                    </div>
                    {timeLeft === 0 && <button onClick={() => {setTimeLeft(30); setScore(0)}} className="bg-blue-600 px-8 py-3 rounded-full font-black italic uppercase">Start Game</button>}
                </div>
            );
        };

        // --- MAIN SYSTEM ---
        const App = () => {
            const [activeApp, setActiveApp] = useState(null);
            const [apiKey, setApiKey] = useState(localStorage.getItem('groq_key') || '');
            const [assetIdx, setAssetIdx] = useState(0);
            const [prices, setPrices] = useState({ 0: Array(20).fill(65000), 1: Array(20).fill(2300), 2: Array(20).fill(83.5), 3: Array(20).fill(1.0) });
            const assets = [{n:"Bitcoin", s:"‚Çø", b:65000, c:"#F7931A"}, {n:"Gold", s:"AU", b:2300, c:"#FFD700"}, {n:"Indian Rupee", s:"‚Çπ", b:83.5, c:"#16a34a"}, {n:"US Dollar", s:"$", b:1.0, c:"#3b82f6"}];

            useEffect(() => {
                const interval = setInterval(() => {
                    setPrices(prev => {
                        const next = {...prev};
                        [0,1,2,3].forEach(i => {
                            const last = next[i][19];
                            next[i] = [...next[i].slice(1), last + (Math.random()-0.49) * (assets[i].b * 0.02)];
                        });
                        return next;
                    });
                }, 2000);
                return () => clearInterval(interval);
            }, []);

            const cur = prices[assetIdx];
            const apps = [
                { id: 'ai', name: 'Neural Chat', i: 'üß†' }, { id: 'mole', name: 'Whack-Mole', i: 'üî®' },
                { id: 'sketch', name: 'Sketch Pro', i: 'üé®' }, { id: 'settings', name: 'Settings', i: '‚öôÔ∏è' }
            ];

            return (
                <div className="h-screen w-screen flex flex-col p-6 overflow-hidden">
                    {activeApp ? (
                        <div className="fixed inset-0 z-50 glass flex flex-col p-6">
                            <div className="flex justify-between items-center mb-10">
                                <button onClick={() => setActiveApp(null)} className="text-xs font-bold opacity-50 uppercase tracking-widest">‚Üê Return to OS</button>
                                <h2 className="text-xl font-black italic uppercase text-blue-400">{activeApp.name}</h2>
                                <div className="w-10"></div>
                            </div>
                            <div className="flex-1 flex items-center justify-center overflow-hidden">
                                {activeApp.id === 'ai' && <AIChat apiKey={apiKey} />}
                                {activeApp.id === 'mole' && <WhackAMole />}
                                {activeApp.id === 'sketch' && <SketchPad />}
                                {activeApp.id === 'settings' && (
                                    <div className="w-full max-w-sm glass p-8 rounded-3xl">
                                        <p className="text-[10px] font-bold opacity-50 uppercase mb-2">Groq API Key</p>
                                        <input type="password" value={apiKey} onChange={e=>{setApiKey(e.target.value); localStorage.setItem('groq_key', e.target.value)}} className="w-full bg-black/50 p-4 rounded-xl border border-white/10 outline-none" placeholder="gsk_..." />
                                    </div>
                                )}
                            </div>
                        </div>
                    ) : (
                        <div className="max-w-4xl mx-auto w-full">
                            <header className="text-center mb-12">
                                <h1 className="text-4xl font-black italic tracking-tighter uppercase">Intelligence OS</h1>
                                <p className="text-[10px] font-bold text-blue-500 tracking-[0.4em] uppercase">Advanced Logic Core</p>
                            </header>

                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <div onClick={() => setAssetIdx((assetIdx + 1) % 4)} className="col-span-2 glass p-6 rounded-3xl h-36 flex flex-col justify-between">
                                    <div className="flex justify-between font-black">
                                        <span style={{color: assets[assetIdx].c}}>{assets[assetIdx].s} {assets[assetIdx].n}</span>
                                        <span className={cur[19] > cur[18] ? 'text-green-400' : 'text-red-400'}>{cur[19].toFixed(2)}</span>
                                    </div>
                                    <svg className="h-12 w-full" preserveAspectRatio="none" viewBox="0 0 100 20">
                                        <polyline fill="none" stroke={cur[19] > cur[18] ? '#4ade80' : '#f87171'} strokeWidth="3" points={cur.map((p, i) => `${(i / 19) * 100},${20 - ((p / (assets[assetIdx].b * 1.5)) * 20)}`).join(' ')} />
                                    </svg>
                                </div>
                                {apps.map(app => (
                                    <div key={app.id} onClick={() => setActiveApp(app)} className="glass app-card">
                                        <span className="text-3xl mb-2">{app.i}</span>
                                        <span className="text-[9px] font-bold uppercase tracking-widest">{app.name}</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                </div>
            );
        };
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
